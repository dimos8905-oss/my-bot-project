<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Ä¢ –¶–ó–ù –†—è–∑–∞–Ω—å</title>
<script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #f0f4f8; --bg-secondary: #ffffff; --bg-sidebar: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --text-primary: #2d3748; --text-secondary: #718096; --text-sidebar: #ffffff; --text-sidebar-muted: rgba(255,255,255,0.7);
  --accent: #667eea; --danger: #e53e3e; --success: #38a169; --border: #e2e8f0; --shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1); --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
body.dark {
  --bg-primary: #1a202c; --bg-secondary: #2d3748; --text-primary: #e2e8f0; --text-secondary: #a0aec0; --border: #4a5568;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg-primary); color: var(--text-primary); height: 100vh; overflow: hidden;
  transition: var(--transition);
}
.app-container {
  display: grid; grid-template-columns: 280px 1fr; height: 100vh; gap: 0;
}
.sidebar {
  position: sticky; top: 0; height: 100vh; overflow-y: auto; z-index: 100;
  background: var(--bg-sidebar); color: var(--text-sidebar); padding: 30px 20px;
  display: flex; flex-direction: column; box-shadow: var(--shadow-lg);
}
.logo-section { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid var(--glass-border); }
.logo { width: 60px; height: 60px; background: rgba(255,255,255,0.15); border-radius: 16px; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; backdrop-filter: blur(5px); }
.logo-title { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
.logo-subtitle { font-size: 12px; opacity: 0.7; }
.menu-list { display: flex; flex-direction: column; gap: 8px; flex: 1; }
.menu-item {
  padding: 14px 18px; border-radius: 12px; cursor: pointer; transition: var(--transition);
  display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text-sidebar);
  font-weight: 500; background: rgba(255,255,255,0.05); border: 1px solid transparent;
}
.menu-item:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
.menu-item.active { background: rgba(255,255,255,0.2); border-color: var(--glass-border); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
.menu-icon { font-size: 20px; width: 24px; text-align: center; }
.menu-text { flex: 1; }
.menu-badge { background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 8px; font-size: 11px; font-weight: 600; }
.menu-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--glass-border); }
.main-content { padding: 30px; overflow-y: auto; background: var(--bg-primary); }
.content-header { margin-bottom: 30px; }
.content-title { font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px; }
.content-subtitle { color: var(--text-secondary); font-size: 14px; }

/* === –ù–ê–°–¢–†–û–ô–ö–ò === */
.settings-section {
  background: var(--bg-secondary); border-radius: 16px; padding: 25px;
  box-shadow: var(--shadow); margin-bottom: 20px; border: 1px solid var(--border);
}
.settings-section h3 {
  font-size: 18px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);
}
.setting-group {
  display: flex; justify-content: space-between; align-items: center;
  padding: 15px 0; border-bottom: 1px solid var(--border);
}
.setting-group:last-child { border-bottom: none; }
.setting-label {
  flex: 1;
}
.setting-label h4 {
  font-size: 14px; font-weight: 500; margin-bottom: 4px;
}
.setting-label p {
  font-size: 12px; color: var(--text-secondary);
}
.setting-control {
  display: flex; align-items: center; gap: 10px;
}
.toggle-switch {
  position: relative; width: 50px; height: 26px; background: var(--border); border-radius: 13px;
  cursor: pointer; transition: var(--transition);
}
.toggle-switch.active { background: var(--accent); }
.toggle-slider {
  position: absolute; top: 3px; left: 3px; width: 20px; height: 20px;
  background: white; border-radius: 50%; transition: var(--transition);
}
.toggle-switch.active .toggle-slider { transform: translateX(24px); }
.input-field {
  padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px;
  background: var(--bg-secondary); color: var(--text-primary); width: 200px;
}
.select-field {
  padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px;
  background: var(--bg-secondary); color: var(--text-primary); min-width: 150px;
}
.btn {
  padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer;
  font-size: 14px; font-weight: 500; transition: var(--transition);
}
.btn-primary { background: var(--accent); color: white; }
.btn-primary:hover { background: #5a67d8; transform: translateY(-1px); }
.btn-danger { background: var(--danger); color: white; }
.btn-danger:hover { background: #c53030; }
.status-indicator {
  display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 8px;
}
.status-online { background: #38a169; }
.status-offline { background: var(--danger); }

@media (max-width: 768px) {
  .app-container { grid-template-columns: 1fr; }
  .sidebar { position: fixed; top: 0; left: 0; width: 280px; height: 100vh; transform: translateX(-100%); z-index: 1000; transition: transform 0.3s; }
  .sidebar.open { transform: translateX(0); }
  .menu-toggle { position: fixed; top: 20px; left: 20px; z-index: 1001; background: var(--accent); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; }
}
@media (min-width: 769px) { .menu-toggle { display: none; } }
@media (prefers-reduced-motion: reduce) { * { transition: none !important; animation: none !important; } }
</style>
</head>
<body>
{% if session.get('logged_in') %}
<div class="app-container">
  <nav class="sidebar" aria-label="–ì–ª–∞–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="logo-section">
      <div class="logo">üè¢</div>
      <div class="logo-title">–¶–ó–ù –†—è–∑–∞–Ω—å</div>
      <div class="logo-subtitle">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
    </div>
    <div class="menu-list">
      <a href="/dashboard" class="menu-item">
        <span class="menu-icon" aria-hidden="true">üìã</span>
        <span class="menu-text">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏</span>
        <span class="menu-badge" id="active-count">0</span>
      </a>
      <a href="/statistics" class="menu-item">
        <span class="menu-icon" aria-hidden="true">üìä</span>
        <span class="menu-text">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
      </a>
      <a href="/settings" class="menu-item active" aria-current="page">
        <span class="menu-icon" aria-hidden="true">‚öôÔ∏è</span>
        <span class="menu-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      </a>
      <a href="/logout" class="menu-item">
        <span class="menu-icon" aria-hidden="true">üö™</span>
        <span class="menu-text">–í—ã—Ö–æ–¥</span>
      </a>
    </div>
    <div class="menu-footer">
      <small style="opacity: 0.6; padding: 0 18px;">–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: Luiz</small>
    </div>
  </nav>

  <main class="main-content">
    <div class="content-header">
      <h1 class="content-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–Ω–µ–ª–∏</h1>
      <p class="content-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ä–∞–±–æ—Ç—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</p>
    </div>

    <!-- === –û–ë–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò === -->
    <div class="settings-section">
      <h3>–û–±—â–∏–µ</h3>
      
      <div class="setting-group">
        <div class="setting-label">
          <h4>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</h4>
          <p>–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–≤–µ—Ç–ª–æ–π –∏ —Ç–µ–º–Ω–æ–π —Ç–µ–º–æ–π</p>
        </div>
        <div class="setting-control">
          <div class="toggle-switch" id="themeToggle" onclick="toggleTheme()">
            <div class="toggle-slider"></div>
          </div>
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-label">
          <h4>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞</h4>
          <p>–û–±–Ω–æ–≤–ª—è—Ç—å –∑–∞—è–≤–∫–∏ –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥</p>
        </div>
        <div class="setting-control">
          <select class="select-field" id="autoRefresh" onchange="saveSetting('autoRefresh', this.value)">
            <option value="0">–í—ã–∫–ª—é—á–µ–Ω–æ</option>
            <option value="5">5 —Å–µ–∫—É–Ω–¥</option>
            <option value="10">10 —Å–µ–∫—É–Ω–¥</option>
            <option value="30">30 —Å–µ–∫—É–Ω–¥</option>
            <option value="60">1 –º–∏–Ω—É—Ç–∞</option>
          </select>
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-label">
          <h4>–ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
          <p>–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∑–≤—É–∫ –ø—Ä–∏ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ</p>
        </div>
        <div class="setting-control">
          <div class="toggle-switch" id="soundToggle" onclick="toggleSound()">
            <div class="toggle-slider"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- === –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–ê–¢–£–°–û–í === -->
    <div class="settings-section">
      <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞—è–≤–æ–∫</h3>
      
      <div class="setting-group">
        <div class="setting-label">
          <h4>–¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ "–û—Ç–∫—Ä—ã—Ç–æ"</h4>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫</p>
        </div>
        <div class="setting-control">
          <input type="color" class="input-field" id="colorOpen" value="#ffe066" onchange="updateStatusColor('–û—Ç–∫—Ä—ã—Ç–æ', this.value)">
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-label">
          <h4>–¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ "–û—Ç–≤–µ—á–µ–Ω–æ"</h4>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –¥–ª—è –∑–∞—è–≤–æ–∫ —Å –æ—Ç–≤–µ—Ç–æ–º</p>
        </div>
        <div class="setting-control">
          <input type="color" class="input-field" id="colorAnswered" value="#b2f2bb" onchange="updateStatusColor('–û—Ç–≤–µ—á–µ–Ω–æ', this.value)">
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-label">
          <h4>–¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ "–ó–∞–∫—Ä—ã—Ç–æ"</h4>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫</p>
        </div>
        <div class="setting-control">
          <input type="color" class="input-field" id="colorClosed" value="#ccc" onchange="updateStatusColor('–ó–∞–∫—Ä—ã—Ç–æ', this.value)">
        </div>
      </div>
    </div>

    <!-- === –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø === -->
    <div class="settings-section">
      <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
      
      <div class="setting-group">
        <div class="setting-label">
          <h4>–í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
          <p>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö</p>
        </div>
        <div class="setting-control">
          <div class="toggle-switch active" id="toastToggle" onclick="toggleToast()">
            <div class="toggle-slider"></div>
          </div>
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-label">
          <h4>–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω</h4>
          <p>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</p>
        </div>
        <div class="setting-control">
          <span class="status-indicator status-online" id="connectionStatus"></span>
          <span id="connectionText">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
        </div>
      </div>
    </div>

    <!-- === –î–ê–ù–ù–´–ï === -->
    <div class="settings-section">
      <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
      
      <div class="setting-group">
        <div class="setting-label">
          <h4>–≠–∫—Å–ø–æ—Ä—Ç –∑–∞—è–≤–æ–∫</h4>
          <p>–°–∫–∞—á–∞—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV</p>
        </div>
        <div class="setting-control">
          <button class="btn btn-primary" onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-label">
          <h4>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</h4>
          <p>–£–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫—ç—à</p>
        </div>
        <div class="setting-control">
          <button class="btn btn-danger" onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </div>

  </main>
</div>

<script>
const socket = io({ reconnection: true, reconnectionAttempts: 5, reconnectionDelay: 1000 });
let autoRefreshInterval = null;

// === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
window.addEventListener('DOMContentLoaded', () => {
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
  document.getElementById('themeToggle').classList.toggle('active', localStorage.getItem('theme') === 'dark');
  document.getElementById('soundToggle').classList.toggle('active', localStorage.getItem('soundEnabled') === 'true');
  document.getElementById('toastToggle').classList.toggle('active', localStorage.getItem('toastEnabled') !== 'false');
  document.getElementById('autoRefresh').value = localStorage.getItem('autoRefresh') || '0';
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–≤–µ—Ç–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤
  const statusColors = JSON.parse(localStorage.getItem('statusColors') || '{}');
  if (statusColors['–û—Ç–∫—Ä—ã—Ç–æ']) document.getElementById('colorOpen').value = statusColors['–û—Ç–∫—Ä—ã—Ç–æ'];
  if (statusColors['–û—Ç–≤–µ—á–µ–Ω–æ']) document.getElementById('colorAnswered').value = statusColors['–û—Ç–≤–µ—á–µ–Ω–æ'];
  if (statusColors['–ó–∞–∫—Ä—ã—Ç–æ']) document.getElementById('colorClosed').value = statusColors['–ó–∞–∫—Ä—ã—Ç–æ'];
  
  applyStatusColors();
  setupAutoRefresh();
});

// === –¢–ï–ú–ê ===
function toggleTheme() {
  const isDark = document.body.classList.toggle('dark');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  document.getElementById('themeToggle').classList.toggle('active', isDark);
}

// === –ó–í–£–ö ===
function toggleSound() {
  const enabled = localStorage.getItem('soundEnabled') !== 'true';
  localStorage.setItem('soundEnabled', enabled);
  document.getElementById('soundToggle').classList.toggle('active', enabled);
  showNotification(`–ó–≤—É–∫ ${enabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`, 'info');
}

// === TOAST –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===
function toggleToast() {
  const enabled = localStorage.getItem('toastEnabled') !== 'true';
  localStorage.setItem('toastEnabled', enabled);
  document.getElementById('toastToggle').classList.toggle('active', enabled);
  showNotification(`–í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ${enabled ? '–≤–∫–ª—é—á–µ–Ω—ã' : '–≤—ã–∫–ª—é—á–µ–Ω—ã'}`, 'info');
}

// === –ê–í–¢–û–û–ë–ù–û–í–õ–ï–ù–ò–ï ===
function setupAutoRefresh() {
  if (autoRefreshInterval) clearInterval(autoRefreshInterval);
  const interval = parseInt(localStorage.getItem('autoRefresh') || '0');
  if (interval > 0) {
    autoRefreshInterval = setInterval(() => {
      socket.emit('refresh_requests');
    }, interval * 1000);
  }
}

function saveSetting(key, value) {
  localStorage.setItem(key, value);
  if (key === 'autoRefresh') setupAutoRefresh();
  showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
}

// === –¶–í–ï–¢–ê –°–¢–ê–¢–£–°–û–í ===
function updateStatusColor(status, color) {
  const colors = JSON.parse(localStorage.getItem('statusColors') || '{}');
  colors[status] = color;
  localStorage.setItem('statusColors', JSON.stringify(colors));
  applyStatusColors();
  showNotification(`–¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ "${status}" –æ–±–Ω–æ–≤–ª–µ–Ω`, 'success');
}

function applyStatusColors() {
  const colors = JSON.parse(localStorage.getItem('statusColors') || '{}');
  const style = document.createElement('style');
  style.id = 'custom-status-colors';
  let css = '';
  if (colors['–û—Ç–∫—Ä—ã—Ç–æ']) css += `.status.–û—Ç–∫—Ä—ã—Ç–æ { background: ${colors['–û—Ç–∫—Ä—ã—Ç–æ']} !important; }`;
  if (colors['–û—Ç–≤–µ—á–µ–Ω–æ']) css += `.status.–û—Ç–≤–µ—á–µ–Ω–æ { background: ${colors['–û—Ç–≤–µ—á–µ–Ω–æ']} !important; }`;
  if (colors['–ó–∞–∫—Ä—ã—Ç–æ']) css += `.status.–ó–∞–∫—Ä—ã—Ç–æ { background: ${colors['–ó–∞–∫—Ä—ã—Ç–æ']} !important; }`;
  style.textContent = css;
  
  const oldStyle = document.getElementById('custom-status-colors');
  if (oldStyle) oldStyle.remove();
  document.head.appendChild(style);
}

// === –≠–ö–°–ü–û–†–¢ ===
function exportData() {
  showNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞...', 'info');
  socket.emit('export_requests', (data) => {
    if (!data || data.length === 0) {
      showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
      return;
    }
    
    const csv = [
      ['ID', '–ò–º—è', '–°–æ–æ–±—â–µ–Ω–∏–µ', '–°—Ç–∞—Ç—É—Å', '–í—Ä–µ–º—è'],
      ...data.map(row => [row.user_id, `"${row.username}"`, `"${row.message}"`, row.status, row.timestamp])
    ].map(row => row.join(',')).join('\n');
    
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `–∑–∞—è–≤–∫–∏_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
    showNotification('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
  });
}

// === –û–ß–ò–°–¢–ö–ê –ö–≠–®–ê ===
function clearCache() {
  if (confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ—á–∏—Å—Ç–∏—Ç –∫—ç—à')) {
    localStorage.clear();
    sessionStorage.clear();
    showNotification('–ö—ç—à –æ—á–∏—â–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...', 'success');
    setTimeout(() => location.reload(), 2000);
  }
}

// === –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===
function showNotification(message, type = 'info') {
  if (localStorage.getItem('toastEnabled') === 'false') return;
  
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed; top: 20px; right: 20px; padding: 12px 20px; z-index: 9999;
    background: ${type === 'error' ? '#e53e3e' : type === 'success' ? '#38a169' : '#3182ce'};
    color: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  setTimeout(() => notification.remove(), 3000);
}

// === –ò–ù–î–ò–ö–ê–¢–û–† –°–û–ï–î–ò–ù–ï–ù–ò–Ø ===
socket.on('connect', () => {
  document.getElementById('connectionStatus').className = 'status-indicator status-online';
  document.getElementById('connectionText').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
});

socket.on('disconnect', () => {
  document.getElementById('connectionStatus').className = 'status-indicator status-offline';
  document.getElementById('connectionText').textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ';
});

// === –ú–û–ë–ò–õ–¨–ù–û–ï –ú–ï–ù–Æ ===
const menuToggle = document.createElement('button');
menuToggle.className = 'menu-toggle';
menuToggle.innerHTML = '‚ò∞';
menuToggle.setAttribute('aria-label', '–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é');
menuToggle.setAttribute('aria-expanded', 'false');
menuToggle.onclick = () => {
  const sidebar = document.querySelector('.sidebar');
  sidebar.classList.toggle('open');
  menuToggle.setAttribute('aria-expanded', sidebar.classList.contains('open'));
};
document.body.appendChild(menuToggle);

document.addEventListener('click', (e) => {
  const sidebar = document.querySelector('.sidebar');
  if (window.innerWidth <= 768 && sidebar.classList.contains('open') && !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
    sidebar.classList.remove('open');
    menuToggle.setAttribute('aria-expanded', 'false');
  }
});
</script>
{% else %}
<script>window.location.href = '/';</script>
{% endif %}
</body>
</html>